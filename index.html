<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŒ¿ Green Egypt AI</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
<style>
body{font-family:'Cairo',sans-serif;background:linear-gradient(180deg,#eafaf0,#f6fff9);}
.card{background:#fff;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.06);padding:16px}
.muted{color:#6b7280} .small{font-size:.85rem;color:#6b7280}
.toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#16a34a;color:#fff;padding:8px 14px;border-radius:8px;display:none;box-shadow:0 6px 18px rgba(2,6,23,.08);}
.chat-user{background:#dcfce7;text-align:right;padding:8px;border-radius:8px}
.chat-bot{background:#f3f4f6;text-align:left;padding:8px;border-radius:8px}
</style>
</head>
<body class="p-6">

<div class="max-w-6xl mx-auto">

<header class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-extrabold text-green-700 flex items-center gap-3">
    ğŸŒ¿ Green Egypt AI
  </h1>
  <div class="flex items-center gap-3">
    <div id="user-badge" class="small muted">ØºÙŠØ± Ù…Ø³Ø¬Ù„</div>
    <button id="auth-btn" class="bg-green-500 text-white px-4 py-2 rounded">ğŸ“§ ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„</button>
    <button id="logout-btn" class="bg-gray-100 px-3 py-2 rounded hidden">Ø®Ø±ÙˆØ¬</button>
  </div>
</header>

<main class="grid grid-cols-1 lg:grid-cols-3 gap-6">

<section class="lg:col-span-2 space-y-4">

<div class="card">
  <h2 class="text-green-700 font-bold mb-2">ğŸ’¬ Ø´Ø§Øª Ø§Ù„ÙØ±ÙŠÙ‚</h2>
  <div id="chat-area" class="h-64 overflow-y-auto p-3 bg-gray-50 rounded mb-3"></div>
  <div class="flex gap-2">
    <input id="chat-msg" class="flex-1 border rounded px-3 py-2" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." />
    <button id="send-msg" class="bg-green-600 text-white px-4 py-2 rounded">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<div class="card">
  <h3 class="text-green-700 font-semibold mb-2">ğŸ’¡ Ù†ØµÙŠØ­Ø© AI</h3>
  <div id="tip-text" class="text-lg font-medium text-center">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
  <button id="refresh-tip" class="bg-green-500 text-white px-3 py-2 rounded mt-2">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙŠØ­Ø©</button>
</div>

<div class="card">
  <h3 class="text-green-700 font-semibold mb-2">ğŸ“ Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
  <div class="flex gap-2 mb-3">
    <input id="task-text" class="flex-1 border p-2 rounded" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ù…Ø©..." />
    <button id="add-task" class="bg-green-600 text-white px-4 py-2 rounded">â• Ø¥Ø¶Ø§ÙØ©</button>
  </div>
  <ul id="tasks-list" class="space-y-2 max-h-56 overflow-y-auto"></ul>
</div>

</section>

<aside class="space-y-4">
<div class="card">
  <h3 class="text-green-700 font-semibold mb-2">ğŸ“¸ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±</h3>
  <input type="file" id="image-file" accept="image/*" class="mb-2"/>
  <button id="upload-btn" class="bg-green-600 text-white px-4 py-2 rounded mb-2">â¬†ï¸ Ø±ÙØ¹</button>
  <div id="images-gallery" class="grid grid-cols-2 gap-2 max-h-64 overflow-y-auto"></div>
</div>
</aside>

</main>

<div id="toast" class="toast">ØªÙ…</div>

<footer class="mt-6 text-sm text-gray-600 text-center">Â© 2025 Green Egypt AI</footer>

</div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBH0e1rmosoI4I6nzI8mksu_z6ULwYijMg",
  authDomain: "green-eg-web.firebaseapp.com",
  projectId: "green-eg-web",
  storageBucket: "green-eg-web.appspot.com",
  messagingSenderId: "365854023627",
  appId: "1:365854023627:web:c93168e45f42b618c1e04e",
  databaseURL: "https://green-eg-web-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
const storage = firebase.storage();

// DOM
const authBtn=document.getElementById('auth-btn');
const logoutBtn=document.getElementById('logout-btn');
const userBadge=document.getElementById('user-badge');
const chatArea=document.getElementById('chat-area');
const chatMsg=document.getElementById('chat-msg');
const sendMsgBtn=document.getElementById('send-msg');
const tipText=document.getElementById('tip-text');
const refreshTip=document.getElementById('refresh-tip');
const taskText=document.getElementById('task-text');
const addTaskBtn=document.getElementById('add-task');
const tasksList=document.getElementById('tasks-list');
const imageFileInput=document.getElementById('image-file');
const uploadBtn=document.getElementById('upload-btn');
const imagesGallery=document.getElementById('images-gallery');
const toast=document.getElementById('toast');

function showToast(msg,time=1800){toast.textContent=msg;toast.style.display='block';setTimeout(()=>toast.style.display='none',time);}

// Auth
authBtn.addEventListener('click',()=>window.location.href='register.html');
logoutBtn.addEventListener('click',()=>auth.signOut());

auth.onAuthStateChanged(user=>{
  if(user){
    userBadge.textContent='ğŸ‘¤ '+user.email.split('@')[0];
    logoutBtn.classList.remove('hidden'); authBtn.classList.add('hidden');
  }else{
    userBadge.textContent='ØºÙŠØ± Ù…Ø³Ø¬Ù„';
    logoutBtn.classList.add('hidden'); authBtn.classList.remove('hidden');
  }
});

// Chat
sendMsgBtn.addEventListener('click',()=>{
  if(chatMsg.value.trim()==='') return;
  const msg=chatMsg.value.trim();
  const div=document.createElement('div'); div.textContent=msg; div.className='chat-user'; chatArea.appendChild(div); chatMsg.value='';
  chatArea.scrollTop=chatArea.scrollHeight;
});

// Tasks
addTaskBtn.addEventListener('click',()=>{
  if(taskText.value.trim()==='') return;
  const li=document.createElement('li'); li.textContent=taskText.value; li.className='p-2 bg-gray-50 rounded'; tasksList.appendChild(li); taskText.value='';
});

// Tips AI (OpenRouter)
async function fetchTip(){
  tipText.textContent='Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
  try{
    const res=await fetch('https://openrouter.ai/api/v1/completions',{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'Authorization':'Bearer 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'
      },
      body:JSON.stringify({
        model:'gpt-4o-mini',
        messages:[{role:'user',content:'Ø§Ø¹Ø·Ù†ÙŠ Ù†ØµÙŠØ­Ø© Ø²Ø±Ø§Ø¹ÙŠØ© Ù‚ØµÙŠØ±Ø© ÙˆÙ…ÙÙŠØ¯Ø©'}],
        max_tokens:80
      })
    });
    const data=await res.json();
    tipText.textContent=data.choices[0].message.content.trim();
  }catch(err){tipText.textContent='Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„';console.error(err);}
}
fetchTip(); refreshTip.addEventListener('click',fetchTip);

// Image Upload
uploadBtn.addEventListener('click',async()=>{
  const file=imageFileInput.files[0]; if(!file){showToast('Ø§Ø®ØªØ± ØµÙˆØ±Ø©!'); return;}
  const ref=storage.ref('images/'+file.name);
  await ref.put(file);
  const url=await ref.getDownloadURL();
  const img=document.createElement('img'); img.src=url; img.className='rounded'; imagesGallery.appendChild(img);
  showToast('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!');
});
</script>

</body>
</html>
